<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Profile Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gray-900 text-white min-h-screen flex items-center justify-center"
  >
    <div class="card-cant"></div>

    <script>
      // XML HTTP Request

      // Select the DOM element where we'll display the profile card
      let cardCant = document.querySelector(".card-cant");

      // The API URL for the GitHub user
      let theURL = `https://api.github.com/users/villionare`;

      const xhr = new XMLHttpRequest();
      xhr.open("GET", theURL, true);

      // Tell XHR to automatically parse the response as JSON
      xhr.responseType = "json";

      // Event listener for when the request's state changes
      xhr.onreadystatechange = () => {
        // readyState property indicates the state of the request:
        // 0: UNSENT (open() not yet called)
        // 1: OPENED (open() has been called)
        // 2: HEADERS_RECEIVED (send() has been called, and headers and status are available)
        // 3: LOADING (Downloading; responseText holds partial data)
        // 4: DONE (The operation is complete)

        if (xhr.readyState === XMLHttpRequest.DONE) {
          // Use XMLHttpRequest.DONE for clarity
          if (xhr.status === 200) {
            const recievedData = xhr.response; // This is now a JS object

            console.log("API Data received:", recievedData); // Log the actual data

            // GENERATE THE HTML CONTENT DYNAMICALLY AFTER DATA IS RECEIVED
            let htmlData = `
                        <div class="flex flex-col md:flex-row bg-[#0D1117] w-[90%] md:w-[700px] lg:w-[800px] h-auto p-6 md:p-8
                                    border border-slate-700 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300">
                            <div class="flex flex-col items-center justify-center md:w-1/3 p-4">
                                <img src="${recievedData.avatar_url}" alt="${
              recievedData.login
            }'s profile"
                                     class="w-32 h-32 md:w-48 md:h-48 rounded-full border-4 border-purple-500 object-cover mb-4 shadow-xl"/>
                                <h2 class="text-3xl font-bold text-teal-300 mb-1">${
                                  recievedData.name || recievedData.login
                                }</h2>
                                <p class="text-gray-400 text-lg">@${
                                  recievedData.login
                                }</p>
                            </div>

                            <div class="flex flex-col md:w-2/3 p-4 space-y-4">
                                ${
                                  recievedData.bio
                                    ? `<p class="text-xl text-gray-300 italic mb-4">"${recievedData.bio}"</p>`
                                    : ""
                                }

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-lg">
                                    <p><strong class="text-indigo-400">Followers:</strong> ${
                                      recievedData.followers
                                    }</p>
                                    <p><strong class="text-indigo-400">Following:</strong> ${
                                      recievedData.following
                                    }</p>
                                    <p><strong class="text-indigo-400">Public Repos:</strong> ${
                                      recievedData.public_repos
                                    }</p>
                                    <p><strong class="text-indigo-400">Gists:</strong> ${
                                      recievedData.public_gists
                                    }</p>
                                </div>

                                ${
                                  recievedData.location
                                    ? `<p class="text-lg"><strong class="text-indigo-400">Location:</strong> ${recievedData.location}</p>`
                                    : ""
                                }
                                ${
                                  recievedData.blog
                                    ? `<p class="text-lg"><strong class="text-indigo-400">Website:</strong> <a href="${recievedData.blog}" target="_blank" class="text-blue-400 hover:underline">${recievedData.blog}</a></p>`
                                    : ""
                                }
                                <p class="text-lg"><strong class="text-indigo-400">GitHub:</strong> <a href="${
                                  recievedData.html_url
                                }" target="_blank" class="text-blue-400 hover:underline">${
              recievedData.html_url
            }</a></p>
                            </div>
                        </div>
                    `;

            // Update the DOM element with the generated HTML
            if (cardCant) {
              // Ensure cardCant exists before trying to modify it
              cardCant.innerHTML = htmlData;
            } else {
              console.error(
                "Error: Element with class 'card-cant' not found in the DOM."
              );
            }
          } else {
            // Log error if API request failed
            console.error(
              `Error fetching data: ${xhr.status} - ${xhr.statusText}`
            );
            // Optionally, display a user-friendly error message in the DOM
            if (cardCant) {
              cardCant.innerHTML = `<p class="text-red-500 text-center">Failed to load profile. Status: ${xhr.status}</p>`;
            }
          }
        }
      };

      // This actually initiates the fetching process.
      // It must be called AFTER you set up the open() and onreadystatechange.
      xhr.send();

      // THIS CONSOLE.LOG WILL LIKELY EXECUTE BEFORE THE API DATA IS FETCHED
      // Because xhr.send() is asynchronous.
      //console.log("Successfully fetched profile:", profile); // Still refers to empty string here.
    </script>
  </body>
</html>
